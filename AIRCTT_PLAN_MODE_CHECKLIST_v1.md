# AIRCTT 1차 통합 체크리스트 (PLAN MODE)

> **작성일**: 2025-12-21
> **모드**: PLAN MODE (설계·분석만, 코드 작성 금지)
> **검수자**: 아미 (최종 승인 후 다음 단계 진행)

---

## 1. 현재 존재하는 요소 ✅

### A. 소비자(Consumer) 영역
| 항목 | 상태 | 위치 |
|------|------|------|
| 소비자 로그인 (이메일/OTP/소셜) | ✅ 존재 | `/consumer/login` |
| 마켓플레이스 홈 | ✅ 존재 | `/consumer` |
| 카테고리별 매장 탐색 | ✅ 존재 | `/consumer/market` |
| 매장 상세 페이지 | ✅ 존재 | `/consumer/stores/[id]` |
| 쿠폰 지갑 | ✅ 존재 | `/consumer/wallet` |
| AR 게임 | ✅ 존재 | `/consumer/game`, `/consumer/ar/[id]` |
| 문화 이벤트/공연 | ✅ 존재 | `/consumer/culture` |
| 좌석 선택 | ✅ 존재 | `/consumer/culture/select-seat/[id]` |
| AI 챗봇 | ✅ 존재 | `AIChatBot.tsx` 컴포넌트 |
| 하단 네비게이션 | ✅ 존재 | `BottomTabNav.tsx` |

### B. 가맹점(Merchant) 영역
| 항목 | 상태 | 위치 |
|------|------|------|
| 가맹점 등록 | ✅ 존재 | `/merchant/register` |
| 대시보드 | ✅ 존재 | `/merchant/dashboard` |
| 쿠폰 관리 (목록/생성/삭제) | ✅ 존재 | `/merchant/coupons`, `/merchant/coupons/new` |
| QR 코드 생성 | ✅ 존재 | `/merchant/qr` |
| 마케팅 도구 | ✅ 존재 | `/merchant/marketing` |
| AI 마케팅 어시스턴트 | ✅ 존재 | `/merchant/ai-assistant` |
| 매장(아울렛) 관리 | ✅ 존재 | `/merchant/outlets` |
| 잔액 충전 (Topup) | ✅ 존재 | `/merchant/topup` |
| 정산 관리 | ✅ 존재 | `/merchant/settlements` |
| 통계 | ✅ 존재 | `/merchant/stats` |
| 설정 | ✅ 존재 | `/merchant/settings` |

### C. 관리자(Admin/CRM) 영역
| 항목 | 상태 | 위치 |
|------|------|------|
| 관리자 로그인 | ✅ 존재 | `/crm/admin/login` |
| 관리자 대시보드 | ✅ 존재 | `/crm/admin` |
| 본사(HQ) 관리 | ✅ 존재 | `/crm/admin/hq` |
| 파트너십 연결 | ✅ 존재 | `/crm/admin/connections` |
| 공지사항/뉴스 | ✅ 존재 | `/crm/admin/news` |

### D. API 엔드포인트
| 항목 | 상태 | 위치 |
|------|------|------|
| 쿠폰 발급 | ✅ 존재 | `POST /api/coupons/issue` |
| 쿠폰 사용 | ✅ 존재 | `POST /api/coupons/use` |
| 게임 시작/종료 | ✅ 존재 | `POST /api/game/start`, `/api/game/finish` |
| 지갑 잔액/내역 | ✅ 존재 | `GET /api/wallet/*` |
| 리워드 클레임 | ✅ 존재 | `POST /api/rewards/claim` |

### E. 데이터베이스 스키마
| 항목 | 상태 |
|------|------|
| users, roles, user_roles | ✅ 존재 |
| merchants, merchant_users, stores | ✅ 존재 |
| coupons, coupon_issues | ✅ 존재 |
| wallets, wallet_transactions | ✅ 존재 |
| game_sessions | ✅ 존재 |
| events, event_entries | ✅ 존재 |
| cultural_events, tickets, seats | ✅ 존재 |
| RLS 정책 | ✅ 존재 |

---

## 2. 빠진 핵심 요소 ❌

### A. 가맹점 가입 시 기본 틀 자동 생성
| 누락 항목 | 우선순위 | 설명 |
|-----------|----------|------|
| ❌ 자동 매장 페이지 생성 | 🔴 높음 | 가맹점 등록 → 기본 매장 프로필 페이지 자동 생성 |
| ❌ 기본 쿠폰 템플릿 제공 | 🔴 높음 | 업종별 추천 쿠폰 템플릿 자동 생성 |
| ❌ 기본 QR 코드 자동 발급 | 🟡 중간 | 등록 완료 시 기본 테이블 QR 자동 생성 |
| ❌ 온보딩 가이드 | 🟡 중간 | 첫 로그인 시 단계별 설정 가이드 |
| ❌ 기본 마케팅 설정 | 🟢 낮음 | 기본 반경, 타겟 고객층 자동 설정 |

### B. 쿠폰 순환 구조 (생성→노출→발급→사용→통계→재방문)
| 누락 항목 | 우선순위 | 설명 |
|-----------|----------|------|
| ❌ 쿠폰 노출 로직 | 🔴 높음 | 반경 기반 / 카테고리 기반 쿠폰 노출 알고리즘 |
| ❌ 쿠폰 사용 후 통계 자동 집계 | 🔴 높음 | 사용률, 전환율, 재방문율 자동 계산 |
| ❌ 재방문 유도 쿠폰 자동 발급 | 🟡 중간 | 사용 후 X일 뒤 자동 재발급 로직 |
| ❌ 쿠폰 업그레이드 규칙 엔진 | 🟡 중간 | N개 수집 시 상위 쿠폰 자동 업그레이드 |
| ❌ 쿠폰 만료 알림 | 🟢 낮음 | 만료 D-3, D-1 푸시/이메일 알림 |

### C. 관리자 승인 워크플로우
| 누락 항목 | 우선순위 | 설명 |
|-----------|----------|------|
| ❌ 가맹점 승인 대기열 | 🔴 높음 | 가맹점 신청 → 관리자 승인 → 활성화 플로우 |
| ❌ 쿠폰 심사/승인 | 🟡 중간 | 특정 쿠폰 유형 관리자 사전 승인 |
| ❌ 콘텐츠 검수 큐 | 🟡 중간 | 이미지/영상 업로드 검수 |
| ❌ 승인 히스토리 로그 | 🟢 낮음 | 승인/반려 이력 추적 |

### D. 황금토끼(Golden Rabbit) 관리자 역할
| 누락 항목 | 우선순위 | 설명 |
|-----------|----------|------|
| ❌ 황금토끼 대시보드 | 🔴 높음 | CCTV 개념의 전체 모니터링 뷰 |
| ❌ 실시간 거래 모니터링 | 🔴 높음 | 쿠폰 발급/사용 실시간 스트림 |
| ❌ 이상 거래 탐지 알림 | 🟡 중간 | 비정상 패턴 자동 감지 |
| ❌ 가맹점별 건강도 지표 | 🟡 중간 | 활성도, 쿠폰 사용률, 클레임 비율 |
| ❌ 감사 로그 뷰어 | 🟢 낮음 | 전체 시스템 액션 로그 열람 |

### E. URL·홍보·마케팅 연결 구조
| 누락 항목 | 우선순위 | 설명 |
|-----------|----------|------|
| ❌ 가맹점 전용 URL 생성 | 🔴 높음 | `ctt.kr/store/가맹점명` 형태 숏링크 |
| ❌ 쿠폰 공유 딥링크 | 🔴 높음 | 카카오/SNS 공유용 딥링크 생성 |
| ❌ UTM 파라미터 트래킹 | 🟡 중간 | 마케팅 채널별 유입 추적 |
| ❌ 소셜 미리보기 메타태그 | 🟡 중간 | OG 태그 자동 생성 |
| ❌ 홍보 배너/포스터 자동 생성 | 🟢 낮음 | 쿠폰 기반 홍보물 템플릿 |

### F. 알림/푸시 시스템
| 누락 항목 | 우선순위 | 설명 |
|-----------|----------|------|
| ❌ 푸시 알림 인프라 | 🔴 높음 | FCM/APNs 연동 |
| ❌ 이메일 발송 시스템 | 🟡 중간 | 트랜잭션 이메일 (회원가입, 쿠폰 발급 등) |
| ❌ SMS 발송 | 🟢 낮음 | 본인인증, 긴급 알림용 |

---

## 3. 중복·충돌 요소 ⚠️

### A. 파일/폴더 중복
| 항목 | 위치 | 문제점 | 권장 조치 |
|------|------|--------|-----------|
| `CTT_MCP/` 폴더 | 루트 | 별도 Next.js 앱 복사본 존재 | 🗑️ 삭제 또는 통합 |
| 매장 상세 페이지 중복 | `/consumer/stores/[id]`, `/consumer/market/store/[id]` | 동일 기능 2개 존재 | 🔀 하나로 통합 |
| `BottomNav` vs `BottomTabNav` | 컴포넌트 | 유사 컴포넌트 2개 | 🔀 통합 |
| `coupon_3d.html` | 루트 | 프로젝트와 무관한 파일 | 🗑️ 삭제 또는 이동 |

### B. 서비스 레이어 충돌
| 항목 | 문제점 | 권장 조치 |
|------|--------|-----------|
| `merchant-service.ts` LocalStorage 사용 | MVP용 임시 저장소, Supabase와 이중 구조 | 🔀 Supabase 단일화 |
| `consumer-auth.ts` 세션 관리 | LocalStorage + Supabase Auth 혼용 | 🔀 Supabase Auth 단일화 |

### C. 라우트 충돌 가능성
| 항목 | 문제점 | 권장 조치 |
|------|--------|-----------|
| `/dashboard` vs `/merchant/dashboard` | 역할 불명확 | 🏷️ 명확한 용도 정의 |
| `/customers` vs CRM 고객 관리 | B2B vs B2C 혼재 | 🏷️ 역할 분리 |

---

## 4. 1차 순환 구조 정의 🔄

### 핵심 순환 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         AIRCTT 쿠폰 순환 구조                            │
└─────────────────────────────────────────────────────────────────────────┘

[1] 가맹점 가입
      │
      ▼
┌─────────────┐
│ 기본틀 자동  │ ← 매장페이지 + 기본QR + 추천쿠폰템플릿
│    생성     │
└─────────────┘
      │
      ▼
[2] 쿠폰 생성 ──────────────────────────────────────┐
      │                                              │
      ▼                                              │
[3] 쿠폰 노출                                        │
    (반경/카테고리/추천)                              │
      │                                              │
      ▼                                              │
[4] 쿠폰 발급 ◄───── [AR 게임] ◄───── [이벤트]       │
    (소비자 지갑)                                     │
      │                                              │
      ▼                                              │
[5] 쿠폰 사용                                        │
    (가맹점 QR 스캔)                                  │
      │                                              │
      ▼                                              │
[6] 통계 집계 ───────────────────────────────────────┤
    (사용률/전환율)                                   │
      │                                              │
      ▼                                              │
[7] 재방문 유도 ─────────────────────────────────────┘
    (자동 재발급 쿠폰)


┌─────────────────────────────────────────────────────────────────────────┐
│                     황금토끼 모니터링 레이어                              │
├─────────────────────────────────────────────────────────────────────────┤
│  • 전체 거래 실시간 감시 (CCTV 메타포)                                   │
│  • 이상 거래 자동 탐지                                                   │
│  • 가맹점 건강도 모니터링                                                │
│  • 승인 워크플로우 관리                                                  │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 5. 가맹점 기본틀 체크리스트 🏪

### 가맹점 등록 시 자동 생성 항목

| 단계 | 항목 | 자동 생성 내용 | 구현 상태 |
|------|------|----------------|-----------|
| 1 | 가맹점 프로필 | 상호명, 업종, 연락처, 주소 | ✅ 존재 |
| 2 | 기본 매장 (Store) | 첫 번째 매장 자동 등록 | ❌ 미구현 |
| 3 | 매장 페이지 URL | `/store/{slug}` 자동 생성 | ❌ 미구현 |
| 4 | 기본 QR 코드 | 매장용 기본 QR 1개 | ❌ 미구현 |
| 5 | 추천 쿠폰 템플릿 | 업종별 3개 템플릿 제안 | ❌ 미구현 |
| 6 | 지갑 (Wallet) | 초기 잔액 0원 지갑 | ✅ 존재 (DB) |
| 7 | 기본 마케팅 반경 | 500m 기본 설정 | ❌ 미구현 |
| 8 | 온보딩 체크리스트 | 첫 로그인 시 가이드 | ❌ 미구현 |

### 업종별 추천 쿠폰 템플릿

| 업종 | 템플릿 1 | 템플릿 2 | 템플릿 3 |
|------|----------|----------|----------|
| 음식점 | 첫 방문 10% 할인 | 점심 특가 3,000원 할인 | 2인 이상 음료 무료 |
| 소매점 | 신규회원 5% 할인 | 5만원 이상 5,000원 할인 | 리뷰 작성 시 적립금 |
| 문화시설 | 평일 20% 할인 | 동반 1인 무료 | 조기예매 할인 |
| 서비스업 | 첫 이용 20% 할인 | 재방문 10% 할인 | 친구 추천 쿠폰 |

---

## 6. 관리자 승인 & 황금토끼 역할 🐰

### A. 승인 워크플로우

```
[가맹점 신청] → [대기(PENDING)] → [검토(REVIEW)] → [승인(APPROVED)/반려(REJECTED)]
                      │                  │
                      │                  ▼
                      │           [보완요청(REVISION)]
                      │                  │
                      └──────────────────┘
```

### B. 승인 대상 항목

| 대상 | 자동 승인 | 수동 승인 필요 |
|------|-----------|----------------|
| 가맹점 등록 | ❌ | ✅ 관리자 검토 후 승인 |
| 일반 쿠폰 생성 | ✅ | - |
| 고가 쿠폰 (50% 이상 할인) | ❌ | ✅ 검토 필요 |
| 이벤트 등록 | ✅ (소규모) | ✅ (대규모) |
| 문화공연 등록 | ❌ | ✅ 필수 검토 |

### C. 황금토끼 관리자 역할 정의

| 역할 | 설명 | 기능 |
|------|------|------|
| 👁️ 모니터링 | 전체 시스템 실시간 감시 | 거래 스트림, 가맹점 상태, 소비자 활동 |
| 🔍 감사 | 이상 거래 탐지 및 조사 | 패턴 분석, 로그 열람, 리포트 생성 |
| ✅ 승인 | 가맹점/쿠폰/이벤트 승인 | 승인 큐 관리, 반려 사유 작성 |
| 📊 분석 | 플랫폼 전체 통계 | KPI 대시보드, 트렌드 분석 |
| 🛡️ 제재 | 정책 위반 처리 | 가맹점 일시정지, 쿠폰 비활성화 |

### D. 황금토끼 대시보드 구성 (설계안)

```
┌─────────────────────────────────────────────────────────────────┐
│  🐰 황금토끼 관제센터                           [실시간] [일간] │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [실시간 거래 스트림]           [승인 대기]    [이상 감지 알림] │
│  ┌───────────────────┐        ┌──────────┐   ┌──────────────┐  │
│  │ 14:32 쿠폰발급     │        │ 가맹점 3 │   │ ⚠️ 비정상    │  │
│  │ 14:31 쿠폰사용     │        │ 쿠폰   5 │   │   패턴 감지  │  │
│  │ 14:30 게임완료     │        │ 이벤트 2 │   │              │  │
│  └───────────────────┘        └──────────┘   └──────────────┘  │
│                                                                 │
│  [가맹점 건강도 맵]            [오늘의 KPI]                     │
│  ┌───────────────────┐        ┌──────────────────────────────┐ │
│  │  🟢 정상: 142     │        │ 쿠폰 발급: 1,234 (+12%)      │ │
│  │  🟡 주의: 23      │        │ 쿠폰 사용: 567 (+8%)         │ │
│  │  🔴 위험: 5       │        │ 신규 가맹점: 7               │ │
│  └───────────────────┘        │ 신규 소비자: 89              │ │
│                               └──────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

---

## 7. 결제 전략 (후순위) 💳

### A. 현재 상태

- 결제 UI: `/merchant/topup` 존재 (카드/계좌이체/모바일)
- DB 스키마: `payments` 테이블 존재
- 실제 PG 연동: ❌ 미연동

### B. 국내 PG 후보

| PG사 | 장점 | 단점 | 우선순위 |
|------|------|------|----------|
| 토스페이먼츠 | API 현대적, 문서 우수 | 수수료 중간 | 🥇 1순위 |
| 아임포트(포트원) | 통합 결제, 다양한 PG 지원 | 추가 수수료 | 🥈 2순위 |
| KG이니시스 | 안정성, 대형 가맹점 | API 구식 | 🥉 3순위 |
| NHN KCP | 안정성 | 설정 복잡 | 4순위 |
| 카카오페이 | 간편결제 인지도 | 독립 PG 아님 | 보조 수단 |
| 네이버페이 | 네이버 연동 | 독립 PG 아님 | 보조 수단 |

### C. 결제 구현 우선순위

| 단계 | 항목 | 시점 |
|------|------|------|
| Phase 1 | 가맹점 충전 결제 (Topup) | Sprint 3 이후 |
| Phase 2 | 테이블 오더 결제 | Sprint 4 이후 |
| Phase 3 | 문화공연 티켓 결제 | Sprint 5 이후 |
| Phase 4 | 정산 시스템 | Sprint 6 이후 |

### D. 결제 플로우 설계 (안)

```
[결제 요청] → [PG 위젯 호출] → [결제 승인] → [Webhook 수신] → [DB 기록] → [완료]
                                    │
                                    ▼
                              [실패 시 재시도/알림]
```

---

## 8. Sprint 1~3 단계별 체크리스트 📋

---

### Sprint 1: 기반 정비 & 가맹점 자동화 (핵심)

**목표**: 가맹점 가입 시 기본틀 자동 생성, 중복 제거

| # | 작업 항목 | 유형 | 우선순위 |
|---|-----------|------|----------|
| 1.1 | 가맹점 등록 → 기본 Store 자동 생성 로직 | 백엔드 | 🔴 필수 |
| 1.2 | 매장 전용 URL slug 자동 생성 | 백엔드 | 🔴 필수 |
| 1.3 | 업종별 추천 쿠폰 템플릿 데이터 구축 | 데이터 | 🔴 필수 |
| 1.4 | 가맹점 등록 시 기본 QR 자동 생성 | 백엔드 | 🟡 권장 |
| 1.5 | `CTT_MCP/` 폴더 정리 (삭제 또는 통합) | 정리 | 🟡 권장 |
| 1.6 | 매장 상세 페이지 중복 통합 | 프론트 | 🟡 권장 |
| 1.7 | LocalStorage → Supabase 마이그레이션 계획 | 설계 | 🟢 선택 |

**Sprint 1 완료 조건**:
- [ ] 가맹점 등록 시 Store 자동 생성됨
- [ ] 매장 URL이 자동으로 할당됨
- [ ] 업종별 추천 쿠폰 템플릿 제안됨

---

### Sprint 2: 쿠폰 순환 구조 완성

**목표**: 쿠폰 노출→발급→사용→통계 순환 연결

| # | 작업 항목 | 유형 | 우선순위 |
|---|-----------|------|----------|
| 2.1 | 쿠폰 노출 알고리즘 설계 (반경/카테고리) | 백엔드 | 🔴 필수 |
| 2.2 | 쿠폰 사용 시 통계 자동 집계 | 백엔드 | 🔴 필수 |
| 2.3 | 가맹점 대시보드에 통계 위젯 추가 | 프론트 | 🔴 필수 |
| 2.4 | 쿠폰 업그레이드 규칙 엔진 설계 | 설계 | 🟡 권장 |
| 2.5 | 재방문 유도 쿠폰 자동 발급 설계 | 설계 | 🟡 권장 |
| 2.6 | 쿠폰 공유 딥링크 생성 기능 | 백엔드 | 🟢 선택 |

**Sprint 2 완료 조건**:
- [ ] 소비자가 위치/카테고리 기반으로 쿠폰 노출받음
- [ ] 쿠폰 사용 시 가맹점 통계에 즉시 반영됨
- [ ] 사용률/전환율 지표 확인 가능

---

### Sprint 3: 관리자 승인 & 황금토끼 v1

**목표**: 가맹점 승인 워크플로우, 황금토끼 기본 대시보드

| # | 작업 항목 | 유형 | 우선순위 |
|---|-----------|------|----------|
| 3.1 | 가맹점 승인 상태 필드 추가 (PENDING/APPROVED/REJECTED) | DB | 🔴 필수 |
| 3.2 | 관리자용 승인 대기열 UI | 프론트 | 🔴 필수 |
| 3.3 | 승인/반려 API 엔드포인트 | 백엔드 | 🔴 필수 |
| 3.4 | 황금토끼 대시보드 기본 레이아웃 | 프론트 | 🔴 필수 |
| 3.5 | 실시간 거래 스트림 (최근 20건) | 백엔드 | 🟡 권장 |
| 3.6 | 가맹점 건강도 지표 계산 로직 | 백엔드 | 🟡 권장 |
| 3.7 | 이상 거래 탐지 규칙 설계 | 설계 | 🟢 선택 |

**Sprint 3 완료 조건**:
- [ ] 신규 가맹점이 PENDING 상태로 등록됨
- [ ] 관리자가 승인/반려 처리 가능
- [ ] 황금토끼 대시보드에서 전체 현황 조회 가능

---

## 9. 참고 UX 패턴 (벤치마킹) 📚

> ⚠️ 기능 복제 금지, 패턴만 참고

| 서비스 | 참고 포인트 | 적용 영역 |
|--------|-------------|-----------|
| 배달의민족 | 가맹점 온보딩 플로우 | 가맹점 등록 UX |
| 카카오톡 선물하기 | 쿠폰 공유 딥링크 | 쿠폰 공유 |
| 토스 | 실시간 거래 스트림 UI | 황금토끼 모니터링 |
| Google Analytics | 대시보드 KPI 레이아웃 | 통계 화면 |
| Shopify | 가맹점 기본틀 자동 생성 | 스토어 자동 생성 |
| Amazon Seller Central | 판매자 건강도 지표 | 가맹점 건강도 |

---

## 10. 최종 검수 체크리스트 ✅

아미 검수 항목:

- [ ] 현재 존재하는 요소가 정확히 파악되었는가?
- [ ] 빠진 핵심 요소의 우선순위가 적절한가?
- [ ] 중복/충돌 요소 정리 방향이 맞는가?
- [ ] 순환 구조가 사업 목표와 일치하는가?
- [ ] 가맹점 기본틀 항목이 충분한가?
- [ ] 황금토끼 역할 정의가 적절한가?
- [ ] 결제 전략 우선순위가 맞는가?
- [ ] Sprint 1~3 범위가 적절한가?

---

## 📌 다음 단계

1. **아미 검수 완료** → Sprint 1 상세 설계 진입
2. **Sprint 1 설계 승인** → 구현 모드 전환 가능
3. **구현 전 필수 확인**:
   - Supabase 연결 상태
   - 환경변수 설정
   - 기존 데이터 백업

---

> 📝 **문서 버전**: v1.0
> 🔒 **최종 책임**: 아미
> 🤖 **작성**: Claude (PLAN MODE)

클 화이팅! 💪
